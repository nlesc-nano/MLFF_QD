name: Notify on Push to dev_z
on:
  push:
    branches: [dev_z]  # Later main
jobs:
  notify-push:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Slack (push to branch)
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.MLFF_SLACK_WEBHOOK_URL }}
        run: |
          set -euo pipefail

          short_sha="${GITHUB_SHA::7}"
          commit_message=$(jq -r '.head_commit.message // "No commit message"' "$GITHUB_EVENT_PATH")
          commit_message=$(printf "%s" "$commit_message" | tr '\n' ' ')

          curl -sS -X POST -H 'Content-type: application/json' \
            --data "$(cat <<EOF
          {
            "attachments": [
              {
                "color": "good",
                "text": "*New Push to Branch*: \`$GITHUB_REF_NAME\`\\nPushed by: *$GITHUB_ACTOR*\\nCommit: <${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/commit/${GITHUB_SHA}|\\\`$short_sha\\\`>\\nCommit Message: \\\`$commit_message\\\`"
              }
            ]
          }
          EOF
          )" \
            "$SLACK_WEBHOOK_URL"
